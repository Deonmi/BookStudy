#  尚学堂JAVA高级学习笔记

[TOC]

## 写在前面

学习链接：[Java 视频教程全集](https://www.bilibili.com/video/av59529105/)

课件链接：[Java课件](https://www.sxt.cn/Java_jQuery_in_action/History_Direction.html)

## 第1章 手写webserver

### 1. 反射

- 反射Reflection：把java类中的各种结构（方法、属性、构造器、类名）映射成一个个的java对象。利用反射技术可以对一个类进行解剖，反射是框架设计的灵魂。

- 获取Class对象（三种方式）：推荐使用Class.forName(“完整路径”)

- 可以动态创建对象：clz.getConstructor().newInstance()

- 练习

  ```java
  package com.sxt.Server_study01;
  
  import java.lang.reflect.InvocationTargetException;
  
  /**
   * @author: Li Tian
   * @contact: litian_cup@163.com
   * @software: IntelliJ IDEA
   * @file: ReflectTest.java
   * @time: 2019/11/29 14:55
   * @desc:
   */
  
  public class ReflectTest {
      public static void main(String[] args){
          // 1. 对象.getClass() | 买iphone照着做
          Iphone iphone = new Iphone();
          Class clz = iphone.getClass();
          // 2. 类.class()     | 买通工程师给图纸
          clz = Iphone.class;
          // 3. Class.forName("包名.类名")   | 偷图纸
          try {
              clz = Class.forName("com.sxt.Server_study01.Iphone");
          } catch (ClassNotFoundException e) {
              e.printStackTrace();
          }
  
          // 创建对象
          try {
              Iphone iphone2 = (Iphone)clz.newInstance();
              System.out.println(iphone2);
          } catch (InstantiationException | IllegalAccessException e) {
              e.printStackTrace();
          }
          // 创建对象推荐方式
          try {
              Iphone iphone3 = (Iphone)clz.getConstructor().newInstance();
              System.out.println(iphone3);
          } catch (InstantiationException | IllegalAccessException | InvocationTargetException | NoSuchMethodException e) {
              e.printStackTrace();
          }
      }
  }
  
  class Iphone{
      public Iphone(){
      }
  }
  ```

### 2. 高效解析xml

- XML：Extensible Markup Language，可扩展标记语言，作为数据的一种存储格式或用于存储软件的参数，程序解析此配置文件，就可以达到不修改代码就能更改程序的目的。

- 利用Sax解析XML

- xml例子

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <persons>
      <person>
          <name>至尊宝</name>
          <age>9000</age>
      </person>
      <person>
          <name>白晶晶</name>
          <age>7000</age>
      </person>
  </persons>
  ```

- 制作Person类

  ```java
  package com.sxt.Server_study01;
  
  /**
   * @author: Li Tian
   * @contact: litian_cup@163.com
   * @software: IntelliJ IDEA
   * @file: Person.java
   * @time: 2019/11/29 15:29
   * @desc:
   */
  
  public class Person {
      private String name;
      private int age;
  
      public Person() {
      }
  
      public Person(String name, int age) {
          this.name = name;
          this.age = age;
      }
  
      public String getName() {
          return name;
      }
  
      public void setName(String name) {
          this.name = name;
      }
  
      public int getAge() {
          return age;
      }
  
      public void setAge(int age) {
          this.age = age;
      }
  }
  ```

- 熟悉sax解析流程

  ```java
  package com.sxt.Server_study01;
  
  import org.xml.sax.Attributes;
  import org.xml.sax.SAXException;
  import org.xml.sax.helpers.DefaultHandler;
  
  import javax.xml.parsers.ParserConfigurationException;
  import javax.xml.parsers.SAXParser;
  import javax.xml.parsers.SAXParserFactory;
  import java.io.IOException;
  
  /**
   * @author: Li Tian
   * @contact: litian_cup@163.com
   * @software: IntelliJ IDEA
   * @file: XmlTest01.java
   * @time: 2019/11/29 15:10
   * @desc: 熟悉sax解析流程
   */
  
  public class XmlTest01 {
      public static void main(String[] args) throws ParserConfigurationException, SAXException, IOException {
          // SAX解析
          // 1. 获取解析工厂
          SAXParserFactory factory = SAXParserFactory.newInstance();
          // 2. 从解析工厂获取解析器
          SAXParser parse = null;
          parse = factory.newSAXParser();
          // 3. 加载文档Document注册处理器
          // 4. 编写处理器
          PHandler handler = new PHandler();
          parse.parse(Thread.currentThread().getContextClassLoader().getResourceAsStream("com/sxt/Server_study01/p.xml"), handler);
      }
  }
  
  class PHandler extends DefaultHandler {
      @Override
      public void startDocument() throws SAXException {
          System.out.println("解析文档开始");
      }
  
      @Override
      public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
          System.out.println(qName + "-->解析开始");
      }
  
      @Override
      public void characters(char[] ch, int start, int length) throws SAXException {
          String contents = new String(ch, start, length).trim();
          if(contents.length()>0) {
              System.out.println("内容为：" + contents);
          }else{
              System.out.println("内容为空！");
          }
      }
  
      @Override
      public void endDocument() throws SAXException {
          System.out.println("解析文档结束");
      }
  
      @Override
      public void endElement(String uri, String localName, String qName) throws SAXException {
          System.out.println(qName + "-->解析结束");
      }
  }
  ```

- 获取xml中的内容

  ```java
  package com.sxt.Server_study01;
  
  import org.xml.sax.Attributes;
  import org.xml.sax.SAXException;
  import org.xml.sax.helpers.DefaultHandler;
  
  import javax.xml.parsers.ParserConfigurationException;
  import javax.xml.parsers.SAXParser;
  import javax.xml.parsers.SAXParserFactory;
  import java.io.IOException;
  import java.util.ArrayList;
  import java.util.List;
  
  /**
   * @author: Li Tian
   * @contact: litian_cup@163.com
   * @software: IntelliJ IDEA
   * @file: XmlTest02.java
   * @time: 2019/11/29 15:31
   * @desc: 获取xml中的内容
   */
  
  public class XmlTest02 {
      public static void main(String[] args) throws ParserConfigurationException, SAXException, IOException {
          // SAX解析
          // 1. 获取解析工厂
          SAXParserFactory factory = SAXParserFactory.newInstance();
          // 2. 从解析工厂获取解析器
          SAXParser parse = null;
          parse = factory.newSAXParser();
          // 3. 加载文档Document注册处理器
          // 4. 编写处理器
          PersonHandler handler = new PersonHandler();
          parse.parse(Thread.currentThread().getContextClassLoader().getResourceAsStream("com/sxt/Server_study01/p.xml"), handler);
          // 5. 获取数据
          List<Person> persons = handler.getPersons();
          for (Person p : persons) {
              System.out.println(p.getName() + "-->" + p.getAge());
          }
      }
  }
  
  class PersonHandler extends DefaultHandler {
      private List<Person> persons;
      private Person person;
      private String tag;     // 存储操作的标签
  
      @Override
      public void startDocument() throws SAXException {
          System.out.println("解析文档开始");
          persons = new ArrayList<>();
      }
  
      @Override
      public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
          if (null != qName) {
              tag = qName;        // 存储标签名
              if (tag.equals("person")) {
                  person = new Person();
              }
          }
      }
  
      @Override
      public void characters(char[] ch, int start, int length) throws SAXException {
          String contents = new String(ch, start, length).trim();
          if (contents.length() > 0) {
              if (tag.equals("name")) {
                  person.setName(contents);
              } else if (tag.equals("age")) {
                  person.setAge(Integer.valueOf(contents));
              }
          }
      }
  
      @Override
      public void endElement(String uri, String localName, String qName) throws SAXException {
          if (qName.equals("person")) {
              persons.add(person);
          }
      }
  
      @Override
      public void endDocument() throws SAXException {
          System.out.println("解析文档结束");
      }
  
      public List<Person> getPersons() {
          return persons;
      }
  }
  ```

### 3. 解析webxml

- webxml例子

  ```java
  <?xml version="1.0" encoding="UTF-8"?>
  <web-app>
      <servlet>
          <servlet-name>login</servlet-name>
          <servlet-class>com.sxt.server.basic.servlet.LoginServlet</servlet-class>
      </servlet>
      <servlet>
          <servlet-name>reg</servlet-name>
          <servlet-class>com.sxt.server.basic.servlet.RegisterServlet</servlet-class>
      </servlet>
      <servlet-mapping>
          <servlet-name>login</servlet-name>
          <url-pattern>/login</url-pattern>
          <url-pattern>/g</url-pattern>
      </servlet-mapping>
      <servlet-mapping>
          <servlet-name>reg</servlet-name>
          <url-pattern>/reg</url-pattern>
      </servlet-mapping>
  </web-app>
  ```

- 解析webxml

  ```java
  package com.sxt.Server_study01.servlet;
  
  import com.sxt.Server_study01.Person;
  import org.xml.sax.Attributes;
  import org.xml.sax.SAXException;
  import org.xml.sax.helpers.DefaultHandler;
  
  import javax.xml.parsers.ParserConfigurationException;
  import javax.xml.parsers.SAXParser;
  import javax.xml.parsers.SAXParserFactory;
  import java.io.IOException;
  import java.util.ArrayList;
  import java.util.List;
  
  /**
   * @author: Li Tian
   * @contact: litian_cup@163.com
   * @software: IntelliJ IDEA
   * @file: XmlTest02.java
   * @time: 2019/11/29 15:31
   * @desc: 解析Webxml
   */
  
  public class XmlTest02 {
      public static void main(String[] args) throws ParserConfigurationException, SAXException, IOException {
          // SAX解析
          // 1. 获取解析工厂
          SAXParserFactory factory = SAXParserFactory.newInstance();
          // 2. 从解析工厂获取解析器
          SAXParser parse = null;
          parse = factory.newSAXParser();
          // 3. 加载文档Document注册处理器
          // 4. 编写处理器
          WebHandler handler = new WebHandler();
          parse.parse(Thread.currentThread().getContextClassLoader().getResourceAsStream("com/sxt/Server_study01/servlet/web.xml"), handler);
          // 5. 获取数据
          List<Entity> entitys = handler.getEntitys();
          List<Mapping> mappings = handler.getMappings();
          System.out.println(entitys.size());
          System.out.println(mappings.size());
      }
  }
  
  class WebHandler extends DefaultHandler {
      private List<Entity> entitys;
      private List<Mapping> mappings;
      private Entity entity;
      private Mapping mapping;
      private String tag;
      private boolean isMapping = false;
  
      public List<Entity> getEntitys() {
          return entitys;
      }
  
      public void setEntitys(List<Entity> entitys) {
          this.entitys = entitys;
      }
  
      public List<Mapping> getMappings() {
          return mappings;
      }
  
      public void setMappings(List<Mapping> mappings) {
          this.mappings = mappings;
      }
  
      @Override
      public void startDocument() throws SAXException {
          entitys = new ArrayList<>();
          mappings = new ArrayList<>();
      }
  
      @Override
      public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
          if (null != qName) {
              tag = qName;        // 存储标签名
              if (tag.equals("servlet")) {
                  entity = new Entity();
                  isMapping = false;
              } else if (tag.equals("servlet-mapping")) {
                  mapping = new Mapping();
                  isMapping = true;
              }
          }
      }
  
      @Override
      public void characters(char[] ch, int start, int length) throws SAXException {
          String contents = new String(ch, start, length).trim();
          if (contents.length() > 0) {
              if (isMapping) {// 操作servlet-mapping
                  if (tag.equals("servlet-name")) {
                      mapping.setName(contents);
                  } else if (tag.equals("url-pattern")) {
                      mapping.addPattern(contents);
                  }
              } else {// 操作servlet
                  if (tag.equals("servlet-name")) {
                      entity.setName(contents);
                  } else if (tag.equals("servlet-class")) {
                      entity.setClz(contents);
                  }
              }
          }
      }
  
      @Override
      public void endElement(String uri, String localName, String qName) throws SAXException {
          if (qName.equals("servlet")) {
              entitys.add(entity);
          } else if (qName.equals("servlet-mapping")) {
              mappings.add(mapping);
          }
      }
  }
  ```

### 4. 反射webxml

- xml样例

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <web-app>
      <servlet>
          <servlet-name>login</servlet-name>
          <servlet-class>com.sxt.Server_study01.servlet.LoginServlet</servlet-class>
      </servlet>
      <servlet>
          <servlet-name>reg</servlet-name>
          <servlet-class>com.sxt.Server_study01.servlet.RegisterServlet</servlet-class>
      </servlet>
      <servlet-mapping>
          <servlet-name>login</servlet-name>
          <url-pattern>/login</url-pattern>
          <url-pattern>/g</url-pattern>
      </servlet-mapping>
      <servlet-mapping>
          <servlet-name>reg</servlet-name>
          <url-pattern>/reg</url-pattern>
      </servlet-mapping>
  </web-app>
  ```

- 解析xml

  - Entity类

    ```java
    package com.sxt.Server_study01.servlet;
    
    /**
     * @author: Li Tian
     * @contact: litian_cup@163.com
     * @software: IntelliJ IDEA
     * @file: Entity.java
     * @time: 2019/12/2 13:20
     * @desc:
     */
    
    public class Entity {
        private String name;
        private String clz;
    
        public Entity() {
        }
    
        public String getName() {
            return name;
        }
    
        public void setName(String name) {
            this.name = name;
        }
    
        public String getClz() {
            return clz;
        }
    
        public void setClz(String clz) {
            this.clz = clz;
        }
    }
    ```

  - Mapping类

    ```java
    package com.sxt.Server_study01.servlet;
    
    import java.util.HashSet;
    import java.util.Set;
    
    /**
     * @author: Li Tian
     * @contact: litian_cup@163.com
     * @software: IntelliJ IDEA
     * @file: Mapping.java
     * @time: 2019/12/2 13:21
     * @desc:
     */
    
    public class Mapping {
        private String name;
        private Set<String> patterns;
    
        public Mapping() {
            patterns = new HashSet<>();
        }
    
        public String getName() {
            return name;
        }
    
        public void setName(String name) {
            this.name = name;
        }
    
        public Set<String> getPatterns() {
            return patterns;
        }
    
        public void setPatterns(Set<String> patterns) {
            this.patterns = patterns;
        }
    
        public void addPattern(String pattern){
            this.patterns.add(pattern);
        }
    }
    ```

  - 通过URL的路径找到了对应的class

    ```java
    package com.sxt.Server_study01.servlet;
    
    import java.util.HashMap;
    import java.util.List;
    import java.util.Map;
    
    /**
     * @author: Li Tian
     * @contact: litian_cup@163.com
     * @software: IntelliJ IDEA
     * @file: WebContext.java
     * @time: 2019/12/3 10:51
     * @desc:
     */
    
    public class WebContext {
        private List<Entity> entitys = null;
        private List<Mapping> mappings = null;
    
        // key-->servlet-name  value-->servlet-class
        private Map<String, String> mappingMap = new HashMap<>();
        // key-->url-pattern  value-->servlet-name
        private Map<String, String> entityMap = new HashMap<>();
    
        public WebContext(List<Entity> entitys, List<Mapping> mappings) {
            this.entitys = entitys;
            this.mappings = mappings;
    
            // 将entity的List转成了对应的map
            for(Entity entity: entitys){
                entityMap.put(entity.getName(), entity.getClz());
            }
            // 将map的List转成了对应的map
            for(Mapping mapping: mappings){
                for(String pattern: mapping.getPatterns()){
                    mappingMap.put(pattern, mapping.getName());
                }
            }
        }
    
        // 通过URL的路径找到了对应的class
        public String getClz(String pattern) {
            String name = mappingMap.get(pattern);
            return entityMap.get(name);
        }
    }
    ```

  - 核心代码，取出数据

    ```java
    package com.sxt.Server_study01.servlet;
    
    import com.sun.scenario.effect.impl.sw.sse.SSEBlend_SRC_OUTPeer;
    import org.xml.sax.Attributes;
    import org.xml.sax.SAXException;
    import org.xml.sax.helpers.DefaultHandler;
    
    import javax.xml.parsers.ParserConfigurationException;
    import javax.xml.parsers.SAXParser;
    import javax.xml.parsers.SAXParserFactory;
    import java.io.IOException;
    import java.util.ArrayList;
    import java.util.List;
    
    /**
     * @author: Li Tian
     * @contact: litian_cup@163.com
     * @software: IntelliJ IDEA
     * @file: XmlTest02.java
     * @time: 2019/11/29 15:31
     * @desc: 解析Webxml
     */
    
    public class XmlTest02 {
        public static void main(String[] args) throws Exception {
            // SAX解析
            // 1. 获取解析工厂
            SAXParserFactory factory = SAXParserFactory.newInstance();
            // 2. 从解析工厂获取解析器
            SAXParser parse = null;
            parse = factory.newSAXParser();
            // 3. 加载文档Document注册处理器
            // 4. 编写处理器
            WebHandler handler = new WebHandler();
            parse.parse(Thread.currentThread().getContextClassLoader().getResourceAsStream("com/sxt/Server_study01/servlet/web.xml"), handler);
            // 5. 获取数据
            WebContext context = new WebContext(handler.getEntitys(), handler.getMappings());
            // 假设你输入了 /login or /g
            String className = context.getClz("/g");
            Class clz = Class.forName(className);
            Servlet servlet = (Servlet)clz.getConstructor().newInstance();
            System.out.println(servlet);
            servlet.service();
        }
    }
    
    class WebHandler extends DefaultHandler {
        private List<Entity> entitys;
        private List<Mapping> mappings;
        private Entity entity;
        private Mapping mapping;
        private String tag;
        private boolean isMapping = false;
    
        public List<Entity> getEntitys() {
            return entitys;
        }
    
        public void setEntitys(List<Entity> entitys) {
            this.entitys = entitys;
        }
    
        public List<Mapping> getMappings() {
            return mappings;
        }
    
        public void setMappings(List<Mapping> mappings) {
            this.mappings = mappings;
        }
    
        @Override
        public void startDocument() throws SAXException {
            entitys = new ArrayList<>();
            mappings = new ArrayList<>();
        }
    
        @Override
        public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
            if (null != qName) {
                tag = qName;        // 存储标签名
                if (tag.equals("servlet")) {
                    entity = new Entity();
                    isMapping = false;
                } else if (tag.equals("servlet-mapping")) {
                    mapping = new Mapping();
                    isMapping = true;
                }
            }
        }
    
        @Override
        public void characters(char[] ch, int start, int length) throws SAXException {
            String contents = new String(ch, start, length).trim();
            if (contents.length() > 0) {
                if (isMapping) {// 操作servlet-mapping
                    if (tag.equals("servlet-name")) {
                        mapping.setName(contents);
                    } else if (tag.equals("url-pattern")) {
                        mapping.addPattern(contents);
                    }
                } else {// 操作servlet
                    if (tag.equals("servlet-name")) {
                        entity.setName(contents);
                    } else if (tag.equals("servlet-class")) {
                        entity.setClz(contents);
                    }
                }
            }
        }
    
        @Override
        public void endElement(String uri, String localName, String qName) throws SAXException {
            if (qName.equals("servlet")) {
                entitys.add(entity);
            } else if (qName.equals("servlet-mapping")) {
                mappings.add(mapping);
            }
        }
    }
    ```

  - Servlet接口

    ```java
    package com.sxt.Server_study01.servlet;
    
    /**
     * @author: Li Tian
     * @contact: litian_cup@163.com
     * @software: IntelliJ IDEA
     * @file: Servlet.java
     * @time: 2019/12/3 15:59
     * @desc:
     */
    
    public interface Servlet {
        void service();
    }
    ```

  - 需要被映射的类：Loginservlet

    ```java
    package com.sxt.Server_study01.servlet;
    
    /**
     * @author: Li Tian
     * @contact: litian_cup@163.com
     * @software: IntelliJ IDEA
     * @file: LoginServlet.java
     * @time: 2019/12/3 15:59
     * @desc:
     */
    
    public class LoginServlet implements Servlet {
        @Override
        public void service() {
            System.out.println("LoginServlet");
        }
    }
    ```

  - 需要被映射的类：RegisterServlet

    ```java
    package com.sxt.Server_study01.servlet;
    
    /**
     * @author: Li Tian
     * @contact: litian_cup@163.com
     * @software: IntelliJ IDEA
     * @file: RegisterServlet.java
     * @time: 2019/12/3 15:59
     * @desc:
     */
    
    public class RegisterServlet implements Servlet{
        @Override
        public void service() {
            System.out.println("RegisterServlet");
        }
    }
    ```

### 5. 简单易学的html

- HyperText Markup Language ，超文本标记语言，简单理解为浏览器使用的语言。
- name是后端用的，id是前端用的

------

我的CSDN：https://blog.csdn.net/qq_21579045

我的博客园：https://www.cnblogs.com/lyjun/

我的Github：https://github.com/TinyHandsome

纸上得来终觉浅，绝知此事要躬行~

欢迎大家过来OB~

by 李英俊小朋友