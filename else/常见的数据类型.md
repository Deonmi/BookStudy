### 函数

- 好处：

  - 提高代码的重用性
  - 简化操作
  - 减少了编译次数并且减少了和数据库服务器的连接次数，提高了效率

- 与存储过程的区别：

  - 存储过程：可以有0个返回，也可以有多个返回（适合做批量插入、更新）
  - 函数：有且仅有1个返回（适合处理数据后返回一个结果）

- 创建语法：

  create function 函数名（参数列表） returns 返回类型

  begin

  函数体

  end

  - 注意事项：
    - 参数列表：包含两部分：参数名 参数类型，**注意：没有in，out，inout这种模式了**
    - 函数体：肯定会有return语句，如果没有会报错
    - 如果return语句没有放在函数体的最后也不报错，但不建议
    - 函数体中仅有一句话，则可以省略begin end
    - 使用delimiter语句设置结束标记

- 调用语法：select 函数名(参数列表)

  - 无参有返回

    - 案例1：返回公司的员工个数

      ```
      CREATE FUNCTION myf1() RETURNS INT
      BEGIN
      DECLARE c INT DEFAULT 0;# 定义变量
      SELECT COUNT(*) INTO c# 赋值
      FROM employees;
      RETURN c;
      END $
      
      SELECT myf1()$
      ```

  - 有参有返回

    - 案例1：根据员工名，返回他的工资

      ```
      CREATE FUNCTION myf2(empname VARCHAR(20)) RETURNS DOUBLE
      BEGIN
      SET @sal=0;# 定义用户变量
      SELECT salary INTO @sal# 赋值
      FROM employees
      WHERE last_name = empname;
      RETURN @sal;
      END $
      
      SELECT myf2('kochhar')$
      ```

    - 案例2：根据部门名，返回该部门的平均工资

      ```
      CREATE FUNCTION myf3(deptname VARCHAR(20)) RETURNS DOUBLE
      BEGIN
      DECLARE sal DOUBLE;
      SELECT AVG(salary) INTO sal
      FROM employees e
      JOIN departments d ON e.department_id = d.department_id
      WHERE d.department_name=deptname;
      
      RETURN sal;
      END $
      
      SELECT myf3('IT')$
      ```

- 查看函数：

  ```
  SHOW CREATE FUNCTION myf3;
  ```

- 删除函数：

  ```
  DROP FUNCTION myf3;
  ```

- 案例1：创建函数，实现传入两个float，返回二者之和

  ```
  CREATE FUNCTION test_fun1(num1 FLOAT, num2 FLOAT) RETURNS FLOAT
  BEGIN
  DECLARE SUM FLOAT DEFAULT 0;
  SET SUM=num1+num2;
  RETURN SUM;
  END $
  
  SELECT test_fun1(1,2)$
  ```

## 流程控制结构

- 分类

  - 顺序结构：结构从上往下依次执行
  - 分支结构：程序从两条或多条路径中选择一条去执行
  - 循环结构：程序在满足一定条件的基础上，重复执行一段代码

- 分支结构

  - if函数

    - 功能：实现简单的双分支

    - 语法：

      select if(表达式1，表达式2，表达式3)

    - 执行顺序：

      如果表达式1成立，则if函数返回表达式2的值，否则返回表达式3的值

    - 应用环境：任何地方